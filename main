#!/bin/bash
##____  _                      _      
#|  _ \| |__   ___   ___ _ __ (_)_  __
#| |_) | '_ \ / _ \ / _ \ '_ \| \ \/ /
#|  __/| | | | (_) |  __/ | | | |>  < 
#|_|   |_| |_|\___/ \___|_| |_|_/_/\_\
#                                     
# -*- coding: utf-8 -*-
# Can directly make a choice -c for basic install
# and -f for full install
while getopts ":cfs:" opt; do
  case $opt in
     c)
      INSTALL_TYPE=basic 
      ;;
     f)
      INSTALL_TYPE=full
      ;;
     s)
       SHELL_CHOICE="$OPTARG"  
      ;;   
    \?)
      echo "Invalid option: -$OPTARG" >&2
      exit 1
      ;;
     :) 
       echo "-$OPTARG: Requires an argument"  
         
  esac
done

# Gets the hostname of the machine
hostname=$(cat /etc/hostname &> /dev/null)

# Source Variables and all functions
for source in $(ls functions | xargs -n1) ; do
      source functions/$source
done

for source in $(ls variables | xargs -n1) ; do
      source variables/$source
done


# Install fzf and dialog if its needed
echo "#####################################################"
echo "## Installing 'dialog' and 'fzf' if not installed ##"
echo "#####################################################"

sleep 1;clear

command_exist pacman && sudo pacman -Syyu --needed --noconfirm dialog fzf || error "failed to install fzf"

sleep 1;clear

# Welcome Message
welcome ; clear

# If you run this on the archiso it will go ahead and install arch for you
# just answer some questions and it will install arch for you OBS( YOU NEED TO PARTITION DRIVES FIRST )
# This is not working right now so I disabled it
#[ "$hostname" = "archiso" ] && main-arch-install


# asks what kind of install you want
[ -z "$INSTALL_TYPE" ] && do_settings ; clear


Lastchance ; clear

    
echo "################################"
echo "## Making common user folders ##"
echo "################################" 

home_folders

clear

echo "############################"
echo "## Installing oh my tmux ##"
echo "###########################"

install_oh_my_tmux || error "failed to install oh my tmux"

clear

echo "###################################"
echo "## installing pfetch from source ##"
echo "###################################"
command_exist pacman && sudo pacman -S --needed --noconfirm base-devel

install_pfetch 

if [ "$INSTALL_TYPE" = "basic" ] ; then

   command_exist pacman && install_pacman_base
   
   
        clear
   
   fi


echo "#########################################################"
echo "## Getting all my config files and moving them to home ##"
echo "#########################################################"

cd ./scripts

./dotfiles.sh 

cd ..

do_shell

clear


# If you did choose basic install then the script will exit herre
[ "$INSTALL_TYPE" = "basic" ] && exit


# Installs packages 
if command_exist pacman; then      

    install_pacman_full

    clear

fi    

 
clear

if command_exist qtile ; then

     echo "Qtile is already installed"

else

     echo "######################"
     echo "## installing qtile ##"
     echo "######################"

     install_qtile || error "failed to install qtile" ; clear

fi


clear


if command_exit slock ; then

     echo "Slock is already installed"

else

     echo "##################################"
     echo "## installing slock from source ##"
     echo "##################################"

     install_slock || error "failed to install slock" ; clear

fi

clear

if command_exit picom ; then

     echo "Picom is already installed"

else
    
     echo "######################"
     echo "## Installing Picom ##"
     echo "######################"

     install_picom || error "failed to install picom-jonaburg" ; clear

fi


echo "#############################"
echo "## Setting default browser ##"
echo "#############################"

do_browser




