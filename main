#!/bin/bash
##____  _                      _      
#|  _ \| |__   ___   ___ _ __ (_)_  __
#| |_) | '_ \ / _ \ / _ \ '_ \| \ \/ /
#|  __/| | | | (_) |  __/ | | | |>  < 
#|_|   |_| |_|\___/ \___|_| |_|_/_/\_\
#                                     
# -*- coding: utf-8 -*-
# First I create some switches you can use
# when you run the script to avoid being asked
# but no worries if you just run the script
# it will ask you for input. Like you can choose
# window manager shell etc. And yes I wond addftinfo
# the option to install a Desktop Environment using this script

# -c for basic install (Basically just terminal applications and my config files)
# -f for full install (Here you get to choose an Window Manager too and gets some other things)
# -w for window manager
# -s for shell
# -d for just my dotfiles,zsh,tmux and starship prompt
# -n for no config files (useful if you already have config files you want to use and dont want to overwrite)
while getopts ":w:s:cfd" opt; do
  case ${opt} in
    c)
     INSTALL_TYPE=basic
     ;;
    f)
     INSTALL_TYPE=full
     ;;
    d)
     DOTFILES_ONLY="y"
     ;;
    \?)
      echo "Invalid option: -$OPTARG. Please select hyperland, qtile, or xmonad" 1>&2
      echo "-w (hyprland, qtile, xmonad)"
      echo "-s (zsh, bash, fish)"
      exit 1
      ;;
    w)
      case ${OPTARG} in
        "hyprland" )
         WINDOW_MANAGER="$OPTARG"
          ;;
        "qtile" )
         WINDOW_MANAGER="$OPTARG"
          ;;
        *)
          echo "Invalid value. Please select hyperland, qtile, or xmonad."
          exit 1
          ;;
      esac
      ;;
    s)
      case ${OPTARG} in
        "zsh" )
         SHELL_CHOICE="$OPTARG"
          ;;
        "bash" )
         SHELL_CHOICE="$OPTARG"
          ;;
        "fish" )
        SHELL_CHOICE="$OPTARG"
          ;;
        *)
          echo "Invalid value. Please select zsh, bash, or fish."
          exit 1
          ;;
      esac
      ;;
    \?)
         echo "Invalid option: -$OPTARG. Please select hyperland, qtile, or xmonad" 1>&2
         echo "-w (hyprland, qtile, xmonad)"
         echo "-s (zsh, bash, fish)"
         exit 1
      ;;
    :)
         echo "Invalid option: -$OPTARG requires an argument." 1>&2
         echo "-w (hyprland, qtile, xmonad)"
         echo "-s (zsh, bash, fish)"
         exit 1
      ;;
  esac

done


# Source Variables and all functions
# So we can get all my functions
# I wrote them in seperate files to try and stay organized
for source in $(ls functions | xargs -n1) ; do
      source functions/$source
done

for source in $(ls variables | xargs -n1) ; do
      source variables/$source
done

# Install fzf and dialog if its needed cause it will be used in the script
# So we need to install them
echo "#####################################################"
echo "## Installing 'dialog' and 'fzf' if not installed ##"
echo "#####################################################"

sleep 1;clear

command_exist pacman && sudo pacman -Syy --needed --noconfirm dialog fzf zsh || error "failed to install fzf"

# Welcome Message
welcome ; clear

# Asks you one last time if you really wanna continue
Lastchance ; clear

if [ "$DOTFILES_ONLY" = "y" ] ; then

   # Runs the dotfiles script which clones my dotfiles repo
   # and moves all my configuration files to home
   echo "#########################################################"
   echo "## Getting all my config files and moving them to home ##"
   echo "#########################################################"
   sleep 2
   install_config
   exit


else

    # Runs the dotfiles script which clones my dotfiles repo
    # and moves all my configuration files to home
    echo "#########################################################"
    echo "## Getting all my config files and moving them to home ##"
    echo "#########################################################"
    sleep 2

    install_config

fi

sleep 1;clear

# Asks what kind of install you want if you
# Didn't use -c or -f
[ -z "$INSTALL_TYPE" ] && do_settings ; clear


# If you didn't choocse window manager and choose full install
# Then it will ask you which one you want to install
if [ "$INSTALL_TYPE" = "full" ] ; then

      [ -z "$WINDOW_MANAGER" ] && do_windowmanager

fi

clear

# If you didnt choose shell then it will ask you
[ -z "$SHELL_CHOICE" ] && do_shell


# Asks you which default browser you want
#[ "$INSTALL_TYPE" = "full" ] && do_browser


# Just making some home folders cause why notepad
# Making Documents,Downloads,Pictures and Videos
# If they dont already exist
echo "################################"
echo "## Making common user folders ##"
echo "################################" 
home_folders || error "Failed to create home folders"

clear

# Installs oh-my-tmux which is a plugin manager for tmux
# Which I really enjoy to use
echo "############################"
echo "## Installing oh my tmux ##"
echo "###########################"
install_oh_my_tmux || error "failed to install oh my tmux"

clear


# Installs pfetch from source cloning the repo
# and runs make install. You can find the function under
# function directory called install
echo "###################################"
echo "## installing pfetch from source ##"
echo "###################################"
command_exist pacman && sudo pacman -S --needed --noconfirm base-devel

# only installs if pfetch is not installed
command_exist pfetch || install_pfetch

clear

# Installs paru aur helper if its not installed
echo "#####################"
echo "## installing paru ##"
echo "#####################"

sleep 2

clear

# only installs if paru is not installed
command_exist paru || install_paru && echo "Paru is installed"

if [ "$INSTALL_TYPE" = "basic" ] ; then

   command_exist pacman && install_pacman_base

   clear



elif [ "$INSTALL_TYPE" = "full" ] ; then

   command_exist pacman &&  install_pacman_full

   clear

fi

sleep 2

clear

# Change default shell
sudo usermod -s "/usr/bin/$SHELL_CHOICE" $USER
clear

# If you did choose basic install then the script will exit herre
[ "$INSTALL_TYPE" = "basic" ] && exit

clear


[ -d $HOME/.local/share ] || mkdir -p $HOME/.local/share


echo "######################"
echo "## installing fonts ##"
echo "######################"
install_fonts



clear

# If you choose qtile then it will go and do things thats specific for
# qtile and xorg this is important because hyprland is based on wayland
# so the dependencies will be diffrent
if [ $WINDOW_MANAGER = "qtile" ] ; then


    paru -S --needed --noconfirm  qtile-extras xorg-xrandr

   # Only installs qtile if needed
   if command_exist qtile ; then

         echo "Qtile is already installed"

   else

         echo "######################"
         echo "## installing qtile ##"
         echo "######################"
         paru -S --needed --noconfirm qtile

   fi

   clear

   # If slock is installed it wont install it
   if command_exist slock ; then

         echo "Slock is already installed"

   else
         echo "##################################"
         echo "## installing slock from source ##"
         echo "##################################"

         install_slock
         sleep 1;clear
   fi



elif [ $WINDOW_MANAGER = "hyprland" ] ; then


    paru -S --needed --noconfirm waybar-hyprland-git swaylock swaybg grim wofi awesome-terminal-fonts adobe-source-code-pro-fonts ttf-jetbrains-mono xdg-desktop-portal-hyprland-git wlogout


   # Only installs qtile if needed
   if command_exist Hyprland ; then

         echo "Hyprland is already installed"

   else
         # Installs hyprland
         echo "#########################"
         echo "## installing hyprland ##"
         echo "#########################"

         paru -S --needed --noconfirm hyprland || error "failed to install hyprland" ; clear

   fi

   clear


fi

echo "#############################"
echo "## installing aur packages ##"
echo "#############################"
sleep 1;clear

command_exist paru && install_paru_base

clear

echo "###########################"
echo "## installing sddm theme ##"
echo "###########################"
clear;sddm_theme;clear


echo "##########################"
echo "## installing gtk theme ##"
echo "##########################"

clear;GTK_theme

sleep 2;clear

install_doom

sleep 2;clear
echo "#########################"
echo "## Everything is done! ##"
echo "#########################"
